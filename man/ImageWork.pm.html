<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>lib/ImageWork.pm</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:root@localhost" />
</head>

<body style="background-color: white">


<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#_____________________________">Общие процедуры</a></li>
	<ul>

		<li><a href="#img_fileparse">img_fileparse</a></li>
		<li><a href="#img_resize_list">img_resize_list</a></li>
		<li><a href="#destination_folder">destination folder</a></li>
		<li><a href="#img_relative_folder">img_relative_folder</a></li>
		<li><a href="#img_resize_by_rules">img_resize_by_rules</a></li>
		<li><a href="#img_convert_name">img_convert_name</a></li>
	</ul>

</ul>

<hr name="index" />
</div>
<!-- INDEX END -->

<p>
</p>
<h1><a name="_____________________________">Общие процедуры</a></h1>
<p>Процедуры, которые управляют изображениями решено вынести в отдельный модуль
для упрощения логики.</p>
<p>
</p>
<h2><a name="img_fileparse">img_fileparse</a></h2>
<p>Процедура корректно разделяет полный путь к файлу на путь, файл и расширение.</p>
<p>Считается, что расширение файла не может быть меньше двух и больше четырёх
символов (7z, docx, jpeg - граничные случаи). В основной же своей массе
расширение имеет длину 3 символа (jpg, png, doc, odt, ...). Если расширение не
удовлетворяет этим условием, то оно считается неизвестным - добавляется суффикс
&quot;.unk&quot;. Интерпретация таких файлов - на совести других модулей сайта.</p>
<p>На выходе - массив (путь, файл, расширение).</p>
<p>
</p>
<h2><a name="img_resize_list">img_resize_list</a></h2>
<p>Сформировать перечень ресайзов. Как минимум три являются стандартными:
- noresize - для сохранения оригинала, файл копируется &quot;как есть&quot;;
- small    - для встраивания в страничку;
- thumb    - для создания галереи превьюшек;</p>
<p>На входе следует указать название галереи, в которую происходит загрузка
изображения. Если такая галерея определена в настройках модуля, то
в список будет включён дополнительный ресайз для указанных размеров;</p>
<p>В настройках модуля может быть указан свой размер превьюшек на случай, если
дизайн подразумевает другой (не 100 на 100 точек) размер превьюшек.</p>
<p>Дефолтный размер ресайза 800х600 точек, если иное не задано параметром default
в секции настроек плагина gallery (plugins-&gt;gallery-&gt;default: ...).</p>
<p>
</p>
<h2><a name="destination_folder">destination folder</a></h2>
<p>Получить абсолютный путь к папке, в которую складываются рисунки. Считается,
что права папки позволяют создавать в ней подпапки. Если требуемой подпапки
не существует, будет произведена попытка её создания.</p>
<p>
</p>
<h2><a name="img_relative_folder">img_relative_folder</a></h2>
<p>Абсолютный путь к папке допустим только пока происходит работа с файлами. При
записи рисунка в БД требуется относительный путь.</p>
<p>
</p>
<h2><a name="img_resize_by_rules">img_resize_by_rules</a></h2>
<p>Принцип работы с изображением таков:</p>
<p>- сторонней процедурой на сервер загружается изображение;</p>
<p>- этой же процедурой ссылка на изображение прописывается в БД;</p>
<p>- формируется список правил преобразования изображения;</p>
<p>- вызывается эта процедура, которая по заданному списку правил выполняет ресайз
изображений</p>
<p>В качестве параметров на входе процедура принимает следующие параметры:</p>
<p>- ссылка (путь) к файлу-оригиналу;</p>
<p>- тип (название) галереи, к которой будет относиться этот файл;</p>
<p>- список правил преобразования для указанной галереи.</p>
<p>Если список правил не будет задан, то процедура вычислит его для указанной на
входе галереи.</p>
<p>Если галерея не будет указана явно, то процедура использует общую галерею с
именем &quot;common&quot;.</p>
<p>Если изображение не считается графическим, то всегда будет создан только
оригинальный файл (без графической обработки).</p>
<p>
</p>
<h2><a name="img_convert_name">img_convert_name</a></h2>
<p>Преобразует имя файла, добавляя после имени суффикс типа файла.</p>
<p>Если изображение не считается графическим, то всегда будет возвращена ссылка на
оригинальный файл.</p>

</body>

</html>
